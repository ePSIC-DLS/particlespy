

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Particle Analysis &mdash; ParticleSpy 0.5.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Plotting and Saving" href="plotting_saving.html" />
    <link rel="prev" title="Segmentation" href="segmentation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ParticleSpy
          

          
          </a>

          
            
            
              <div class="version">
                0.5.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="segmentation.html">Segmentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Particle Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#combining-particles-from-multiple-images">Combining Particles from Multiple Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spectrum-analysis">Spectrum Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#particle-segmentation-with-a-pre-generated-mask">Particle Segmentation with a Pre-Generated Mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-particles-based-on-properties">Cluster Particles Based on Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="#normalize-particle-image-sizes">Normalize Particle Image Sizes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plotting_saving.html">Plotting and Saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="time_series.html">Time Series</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ParticleSpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Particle Analysis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/particle_analysis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="particle-analysis">
<span id="id1"></span><h1>Particle Analysis<a class="headerlink" href="#particle-analysis" title="Permalink to this headline">¶</a></h1>
<p>Once you have chosen your segmentation parameters and have successfully prepared a parameters object you can use this to perform Particle Analysis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">hyperspy.api</span> <span class="k">as</span> <span class="nn">hs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;ParticleSpy/Data/JEOL HAADF Image.dm4&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">particles</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">ParticleAnalysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>Particle Analysis will run the segmentation on your data and calculate a number of parameters for each particle.</p>
<p>The calculated parameters include:</p>
<ul class="simple">
<li><p>Area (“area”)</p></li>
<li><p>Equivalent circular diameter (“”)</p></li>
<li><p>Major and minor axes lengths (“major axis length” and “minor axis length”)</p></li>
<li><p>Circularity (“circularity”)</p></li>
<li><p>Eccentricity (“eccentricity”)</p></li>
<li><p>Solidity (“solidity”)</p></li>
<li><p>Total particle intensity (“intensity”)</p></li>
<li><p>Maximum particle intensity (“intensity_max”)</p></li>
<li><p>X and Y coordinates (“x” and “y”)</p></li>
<li><p>Bounding box area and diagonal length (“bbox_area” and “bbox_length”)</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1">#Syntax for accessing particle properties.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">particles</span><span class="o">.</span><span class="n">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>For more information on particle properties see <span class="xref std std-ref">properties</span>.</p>
<div class="section" id="combining-particles-from-multiple-images">
<h2>Combining Particles from Multiple Images<a class="headerlink" href="#combining-particles-from-multiple-images" title="Permalink to this headline">¶</a></h2>
<p>It is possible to analyse particles from multiple images by passing a previously populated Particle_list object to <code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleAnalysis()</span></code> instead of returning a new Particle_list.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">.</span><span class="n">ParticleAnalysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">particles</span><span class="o">=</span><span class="n">particles</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="spectrum-analysis">
<h2>Spectrum Analysis<a class="headerlink" href="#spectrum-analysis" title="Permalink to this headline">¶</a></h2>
<p>In addition, Particle Analysis will also segment and process simultaneously acquired data if given as an additional dataset in the data list.
This could include EDS, EELS or scanning diffraction data.
The only requirement is that the navigation dimensions of the additional data are the same as the signal dimensions of the image used for segmentation.</p>
<p>In addition, Particle Analysis can do the following processing on EDS data:</p>
<ul class="simple">
<li><p>Obtain the EDS spectrum of each particle.</p></li>
<li><p>Obtain elemental maps of each particle.</p></li>
<li><p>Get the composition of each particle if k-factors or zeta-factors are supplied in the parameters object.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">,</span><span class="n">eds_si</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span><span class="o">.</span><span class="n">generate_eds</span><span class="p">(</span><span class="n">eds_method</span><span class="o">=</span><span class="s1">&#39;CL&#39;</span><span class="p">,</span><span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pt&#39;</span><span class="p">,</span><span class="s1">&#39;Au&#39;</span><span class="p">],</span><span class="n">factors</span><span class="o">=</span><span class="p">[</span><span class="mf">1.7</span><span class="p">,</span><span class="mf">1.9</span><span class="p">],</span><span class="n">store_maps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">particles</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">ParticleAnalysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="particle-segmentation-with-a-pre-generated-mask">
<h2>Particle Segmentation with a Pre-Generated Mask<a class="headerlink" href="#particle-segmentation-with-a-pre-generated-mask" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleAnalysis()</span></code> will also accept pre-generated masks, either generated externally or through the manual option of <code class="xref py py-meth docutils literal notranslate"><span class="pre">SegUI()</span></code>.
In order to use a pre-generated mask it is possible to pass a mask argument to <code class="xref py py-meth docutils literal notranslate"><span class="pre">ParticleAnalysis()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">generated_mask</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;maskfile&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">params</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> <span class="c1"># This isn&#39;t used if you load a pre-generated mask but you still have to pass it.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">particles</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">ParticleAnalysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">generated_mask</span><span class="p">)</span>
</pre></div>
</div>
<p>If you have used the manual segmentation editor in <code class="xref py py-meth docutils literal notranslate"><span class="pre">SegUI()</span></code> you can simply pass ‘UI’ as the mask argument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">particles</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">ParticleAnalysis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="s1">&#39;UI&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="cluster-particles-based-on-properties">
<h2>Cluster Particles Based on Properties<a class="headerlink" href="#cluster-particles-based-on-properties" title="Permalink to this headline">¶</a></h2>
<p>It is possible to do clustering of particles based on their properties.
This can be done using the <a class="reference internal" href="source/ParticleSpy.html#ParticleSpy.ptcl_class.Particle_list.cluster_particles" title="ParticleSpy.ptcl_class.Particle_list.cluster_particles"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cluster_particles()</span></code></a> function.
Clustering uses the scikit-learn package, with the ability to use Kmeans, DBSCAN and OPTICS methods.
For example, if you wanted to separate the particles in to two clusters based on their area and ADF intensity, you could do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">clustered_particles</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">cluster_particles</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="s1">&#39;intensity&#39;</span><span class="p">],</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">clustered_particles</span><span class="p">,</span><span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">,</span><span class="s1">&#39;intensity&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The variable clustered_particles now contains two separate particle lists.</p>
<p>Clustering can be done for an arbitrary number of properties, including manually added parameters.</p>
</div>
<div class="section" id="normalize-particle-image-sizes">
<h2>Normalize Particle Image Sizes<a class="headerlink" href="#normalize-particle-image-sizes" title="Permalink to this headline">¶</a></h2>
<p>Sometimes further processing requires that all particle images have the same dimensions.
In ParticleSpy this can be readily achieved using the <a class="reference internal" href="source/ParticleSpy.html#ParticleSpy.ptcl_class.Particle_list.normalize_boxing" title="ParticleSpy.ptcl_class.Particle_list.normalize_boxing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">normalize_boxing()</span></code></a> function.
The function will set all image dimensions to the largest x and y values in the particle list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">particles</span><span class="o">.</span><span class="n">normalize_boxing</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="plotting_saving.html" class="btn btn-neutral float-right" title="Plotting and Saving" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="segmentation.html" class="btn btn-neutral float-left" title="Segmentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, ePSIC.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>